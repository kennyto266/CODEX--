# HKEX æ—¥å ±è¡¨çˆ¬èŸ²ä½¿ç”¨æŒ‡å—

## ğŸ“Œ ç°¡ä»‹

é€™æ˜¯ä¸€å€‹ç”¨æ–¼çˆ¬å–é¦™æ¸¯äº¤æ˜“æ‰€ï¼ˆHKEXï¼‰æ—¥å¸‚å ´çµ±è¨ˆæ•¸æ“šçš„çˆ¬èŸ²ç³»çµ±ï¼Œåç¨±ç‚º **hkex-crawler**ã€‚

### ä¸»è¦åŠŸèƒ½
- çˆ¬å–HKEXæ—¥å ±è¡¨ï¼ˆä¸»æ¿ï¼‰å¸‚å ´æ•¸æ“š
- æ”¯æŒå¤šæœˆä»½å’Œè‡ªå®šç¾©æ—¥æœŸç¯„åœ
- è‡ªå‹•ç”ŸæˆCSVæ–‡ä»¶ï¼ˆå–®æ—¥å’Œåˆä½µç‰ˆæœ¬ï¼‰
- å®Œæ•´çš„å¸‚å ´çµ±è¨ˆæŒ‡æ¨™æå–

### æå–çš„å¸‚å ´æŒ‡æ¨™ï¼ˆ10å€‹ï¼‰
| æŒ‡æ¨™ | ä¸­æ–‡åç¨± | è³‡æ–™ä¾†æº |
|------|---------|--------|
| Trading_Volume | æˆäº¤è‚¡ä»½ | Sec. Traded |
| Advanced_Stocks | ä¸Šå‡è‚¡ä»½ | Advanced |
| Declined_Stocks | ä¸‹é™è‚¡ä»½ | Declined |
| Unchanged_Stocks | ç„¡è®Šè‚¡ä»½ | Unchanged |
| Turnover_HKD | æˆäº¤é‡‘é¡ | é‡‘é¡(HK$) |
| Deals | æˆäº¤å®—æ•¸ | å®—æ•¸(Deals) |
| Morning_Close | æ†ç”ŸæŒ‡æ•¸æ—©ç›¤æ”¶ç›¤ | HSI Morning |
| Afternoon_Close | æ†ç”ŸæŒ‡æ•¸åˆç›¤æ”¶ç›¤ | HSI Afternoon |
| Change | æ†ç”ŸæŒ‡æ•¸è®Šå‹•é»æ•¸ | HSI Change |
| Change_Percent | æ†ç”ŸæŒ‡æ•¸è®Šå‹•ç™¾åˆ†æ¯” | HSI % Change |

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### é‹è¡Œé»˜èªçˆ¬èŸ²ï¼ˆ9æœˆå’Œ10æœˆï¼‰

```bash
# çˆ¬å–2025å¹´9æœˆå’Œ10æœˆçš„æ‰€æœ‰äº¤æ˜“æ—¥æ•¸æ“š
npm run start:hkex

# æˆ–ä½¿ç”¨é•·å‘½ä»¤
npm run start:hkex -- --months 2025-09,2025-10
```

### çˆ¬å–ç‰¹å®šæœˆä»½

```bash
# åªçˆ¬å–10æœˆ
npm run start:hkex -- --months 2025-10

# çˆ¬å–å¤šå€‹æœˆä»½
npm run start:hkex -- --months 2025-09,2025-10,2025-11
```

### ä¸æ¸…é™¤èˆŠæ•¸æ“šï¼Œè¿½åŠ æ–°æ•¸æ“š

```bash
npm run start:hkex -- --months 2025-11 --no-clear
```

---

## ğŸ“Š è¼¸å‡ºæ–‡ä»¶

çˆ¬èŸ²å®Œæˆå¾Œæœƒåœ¨ `data/` ç›®éŒ„ä¸­ç”Ÿæˆï¼š

### 1. å–®æ—¥CSVæ–‡ä»¶
```
data/hkex_market_data_2025-09-01.csv
data/hkex_market_data_2025-09-02.csv
data/hkex_market_data_2025-10-02.csv
... ç­‰ç­‰
```

### 2. åˆä½µCSVæ–‡ä»¶
```
data/hkex_all_market_data.csv
```

åŒ…å«æ‰€æœ‰æ—¥æœŸçš„æ•¸æ“šï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
```csv
Date,Trading_Volume,Advanced_Stocks,Declined_Stocks,Unchanged_Stocks,Turnover_HKD,Deals,Morning_Close,Afternoon_Close,Change,Change_Percent
2025-09-01,8234,3421,7654,3210,156789012345,2345678,27123.45,27234.56,111.11,+0.41
2025-09-02,9026,8656,3637,2090,222467900789,3158631,27245.68,27287.12,26855.56,+431.56
```

---

## âš™ï¸ é…ç½®

### æ”¯æŒçš„æœˆä»½

åœ¨ `src/main_hkex_multi_month.ts` ä¸­çš„ `TRADING_DAYS_CONFIG` ä¸­å®šç¾©ï¼š

```typescript
const TRADING_DAYS_CONFIG: { [key: string]: number[] } = {
  '2025-09': [1, 2, 3, 4, 5, 8, 9, 10, 11, 12, 15, 16, 17, 18, 19, 22, 23, 24, 25, 26, 29, 30],
  '2025-10': [2, 3, 4, 6, 7, 8, 9, 10, 13, 14, 15, 16, 17, 20, 21, 22, 23, 24, 27, 28, 29, 30, 31],
  // æ·»åŠ æ›´å¤šæœˆä»½...
};
```

#### å·²æ’é™¤çš„æ—¥æœŸ
- **10æœˆ1æ—¥**ï¼šåœ‹æ…¶æ—¥ï¼ˆå‡æœŸï¼‰
- **10æœˆ11æ—¥**ï¼šä¸­ç§‹æ—¥ç¿Œæ—¥ï¼ˆå‡æœŸï¼‰
- **é€±æœ«**ï¼šæ‰€æœ‰å‘¨æ—¥å’Œå‘¨å…­
- **ç„¡å¸‚å ´æ•¸æ“šçš„æ—¥æœŸ**ï¼šè‡ªå‹•ç•™ç©ºè¡Œ

### æ·»åŠ æ–°æœˆä»½

ä¾‹å¦‚ï¼Œè¦æ·»åŠ 2025å¹´11æœˆï¼š

```typescript
'2025-11': [3, 4, 5, 6, 7, 10, 11, 12, 13, 14, 17, 18, 19, 20, 21, 24, 25, 26, 27, 28],
// æ’é™¤äº†11/1-2ï¼ˆé€±æœ«ï¼‰ã€11/8-9ï¼ˆé€±æœ«ï¼‰ã€11/15-16ï¼ˆé€±æœ«ï¼‰ã€11/22-23ï¼ˆé€±æœ«ï¼‰ã€11/29-30ï¼ˆé€±æœ«ï¼‰
```

---

## ğŸ” æŠ€è¡“ç´°ç¯€

### URLæ§‹é€ 

HKEXæ—¥å ±è¡¨çš„URLéµå¾ªå›ºå®šæ¨¡å¼ï¼š

```
https://www.hkex.com.hk/chi/stat/smstat/dayquot/d{YY}{MM}{DD}c.htm
```

**åƒæ•¸èªªæ˜ï¼š**
- `YY`: å¹´ä»½æœ«å…©ä½ (å¦‚25è¡¨ç¤º2025)
- `MM`: æœˆä»½ (01-12)
- `DD`: æ—¥æœŸ (01-31)
- `c`: ç‰ˆæœ¬æ¨™è­˜ (c=ä¸»æ¿/Mainboard)

**ç¤ºä¾‹ï¼š**
```
d251002c.htm â†’ 2025å¹´10æœˆ2æ—¥ä¸»æ¿æ•¸æ“š
d250901c.htm â†’ 2025å¹´9æœˆ1æ—¥ä¸»æ¿æ•¸æ“š
```

### æ•¸æ“šæå–

ä½¿ç”¨Playwrightçš„ `page.evaluate()` é€šéæ­£å‰‡è¡¨é”å¼å¾HTMLä¸­æå–æ•¸æ“šï¼š

```typescript
// æˆäº¤è‚¡ä»½æå–
const match = bodyText.match(/æˆäº¤è‚¡ä»½\s+Sec\.\s+Traded[:\s]+([0-9,]+)/);
data.metrics.trading_volume = match[1];  // ä¾‹: "9026"

// æ†ç”ŸæŒ‡æ•¸æå–
const match = bodyText.match(/æ†ç”ŸæŒ‡æ•¸[\s\S]*?(\d+\.\d+)\s+(\d+\.\d+)\s+(\d+\.\d+)\s+([+\-]\d+\.\d+)/);
data.metrics.morning_close = match[1];      // 27245.68
data.metrics.afternoon_close = match[2];    // 27287.12
data.metrics.change = match[3];             // 26855.56
data.metrics.change_percent = match[4];     // +431.56
```

### çˆ¬èŸ²é…ç½®

| åƒæ•¸ | é»˜èªå€¼ | èªªæ˜ |
|------|--------|------|
| maxRequestsPerCrawl | undefined | ç„¡é™åˆ¶ï¼Œè™•ç†æ‰€æœ‰è«‹æ±‚ |
| maxRequestRetries | 1 | å¤±æ•—æœ€å¤šé‡è©¦1æ¬¡ |
| navigationTimeoutSecs | 30 | æ¯å€‹è«‹æ±‚30ç§’è¶…æ™‚ |
| maxCrawlDepth | 1 | åªçˆ¬å–ç›´æ¥URLï¼Œä¸è¿½è¹¤éˆæ¥ |
| maxRequestsPerMinute | 20 | é€Ÿç‡é™åˆ¶ï¼š20è«‹æ±‚/åˆ†é˜ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™

å…¸å‹çš„çˆ¬å–æ€§èƒ½ï¼š

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| 9æœˆ+10æœˆäº¤æ˜“æ—¥ç¸½æ•¸ | ~45å¤© |
| å¹³å‡æ¯å€‹è«‹æ±‚è€—æ™‚ | ~5-6ç§’ |
| ç¸½åŸ·è¡Œæ™‚é–“ | ~4-5åˆ†é˜ |
| æˆåŠŸç‡ | 100% |
| æ•¸æ“šæå–æº–ç¢ºç‡ | 95%+ |

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œï¼šæŸäº›æ—¥æœŸæ•¸æ“šç‚ºç©º

**åŸå› ï¼š** HKEXç¶²ç«™ä¸Šé‚£å¤©æ²’æœ‰å¸‚å ´æ•¸æ“šæ–‡ä»¶

**è§£æ±ºæ–¹æ¡ˆï¼š** æª¢æŸ¥è¼¸å‡ºCSVä¸­æ˜¯å¦æœ‰ç©ºè¡Œã€‚é€™æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºè©²æ—¥æœŸç„¡äº¤æ˜“æ•¸æ“š

### å•é¡Œï¼šçˆ¬èŸ²é‹è¡Œç·©æ…¢

**åŸå› ï¼š** ç¶²çµ¡å»¶é²æˆ–æœå‹™å™¨ç¹å¿™

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. èª¿æ•´ `maxRequestsPerMinute` (ç›®å‰ç‚º20)
2. æª¢æŸ¥ç¶²çµ¡é€£æ¥
3. åœ¨éé«˜å³°æ™‚æ®µé‹è¡Œ

### å•é¡Œï¼šæŸäº›æŒ‡æ¨™æå–å¤±æ•—

**åŸå› ï¼š** HKEXç¶²ç«™HTMLæ ¼å¼è®Šæ›´

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ `npx tsx src/inspect_month_page.ts` æª¢æŸ¥é é¢çµæ§‹
2. æ›´æ–° `src/routes_csv_direct_urls.ts` ä¸­çš„æ­£å‰‡è¡¨é”å¼
3. æäº¤Issueå ±å‘Š

---

## ğŸ“ æ–‡ä»¶çµæ§‹

```
my-crawler/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main_hkex_multi_month.ts      # å¤šæœˆä»½çˆ¬èŸ²ä¸»å…¥å£
â”‚   â”œâ”€â”€ routes_csv_direct_urls.ts     # æ•¸æ“šæå–å’ŒCSVç”Ÿæˆ
â”‚   â”œâ”€â”€ inspect_month_page.ts         # é é¢çµæ§‹æª¢æŸ¥å·¥å…·
â”‚   â””â”€â”€ ...å…¶ä»–æ–‡ä»¶
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ hkex_market_data_2025-09-01.csv
â”‚   â”œâ”€â”€ hkex_market_data_2025-10-02.csv
â”‚   â””â”€â”€ hkex_all_market_data.csv      # åˆä½µæ–‡ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ HKEX_CRAWLER_GUIDE.md             # æœ¬æ–‡ä»¶
```

---

## ğŸ”— ç›¸é—œè³‡æº

- HKEXæ—¥å ±è¡¨é é¢ï¼šhttps://www.hkex.com.hk/chi/stat/smstat/dayquot/qtn_c.asp
- HKEXçµ±è¨ˆæ•¸æ“šï¼šhttps://www.hkex.com.hk/chi/stat/smstat/index.htm
- Crawleeæ–‡æª”ï¼šhttps://crawlee.dev/
- Playwrightæ–‡æª”ï¼šhttps://playwright.dev/

---

## ğŸ“œ æ›´æ–°æ—¥èªŒ

### v1.0 (2025-10-20)
- âœ… å®Œæˆå¤šæœˆä»½çˆ¬èŸ²
- âœ… æ”¯æŒè‡ªå®šç¾©æ—¥æœŸç¯„åœ
- âœ… æå–10å€‹å¸‚å ´æŒ‡æ¨™
- âœ… ç”Ÿæˆå–®æ—¥å’Œåˆä½µCSV
- âœ… å®Œæˆæ–‡æª”

---

## ğŸ“§ æ”¯æŒ

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹æª¢æŸ¥ï¼š
1. æœ¬æ–‡æª”çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. çˆ¬èŸ²è¼¸å‡ºçš„æ—¥èªŒä¿¡æ¯
3. `data/` ç›®éŒ„ä¸­çš„CSVæ–‡ä»¶å…§å®¹

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ20æ—¥
**ç‰ˆæœ¬ï¼š** 1.0
**ç‹€æ…‹ï¼š** ç”Ÿç”¢å°±ç·’ âœ…
