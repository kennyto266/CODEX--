2025-10-18 11:38:03,959 INFO [telegram_bot_test] 🚀 开始 Telegram Bot 综合测试

2025-10-18 11:38:03,959 INFO [telegram_bot_test] ================================================================================
2025-10-18 11:38:03,959 INFO [telegram_bot_test] 第1阶段: 环境检查
2025-10-18 11:38:03,959 INFO [telegram_bot_test] ================================================================================
2025-10-18 11:38:03,959 INFO [telegram_bot_test] 🔍 开始环境检查...

2025-10-18 11:38:03,959 INFO [telegram_bot_test] 📋 检查环境变量...
2025-10-18 11:38:03,959 INFO [telegram_bot_test] 📦 检查 Python 依赖...
2025-10-18 11:38:04,302 INFO [numexpr.utils] Note: NumExpr detected 32 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
2025-10-18 11:38:04,302 INFO [numexpr.utils] NumExpr defaulting to 16 threads.
2025-10-18 11:38:04,639 INFO [telegram_bot_test] 📁 检查文件...
2025-10-18 11:38:04,640 INFO [telegram_bot_test] ⚙️  检查配置文件...
2025-10-18 11:38:04,640 INFO [telegram_bot_test] 
================================================================================
2025-10-18 11:38:04,640 INFO [telegram_bot_test] 第2阶段: 功能验证
2025-10-18 11:38:04,640 INFO [telegram_bot_test] ================================================================================
2025-10-18 11:38:04,640 INFO [telegram_bot_test] 🔎 开始功能验证...

2025-10-18 11:38:04,640 INFO [telegram_bot_test] 📊 验证量化交易系统...
2025-10-18 11:38:04,829 INFO [CPU_CONFIG] 🔧 CPU 核心检测: 总核心数=32, 使用核心数=30
2025-10-18 11:38:04,831 INFO [telegram_bot_test] 🎮 验证命令处理器...
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 🛡️  验证错误处理机制...
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 🔐 验证安全特性...
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 
================================================================================
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 第3阶段: 生成报告
2025-10-18 11:38:04,832 INFO [telegram_bot_test] ================================================================================
2025-10-18 11:38:04,832 INFO [telegram_bot_test] ✅ 报告已保存: telegram_bot_test_report_20251018_113804.txt
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 
================================================================================
2025-10-18 11:38:04,832 INFO [telegram_bot_test] 测试完成总结
2025-10-18 11:38:04,833 INFO [telegram_bot_test] ================================================================================
2025-10-18 11:38:04,833 INFO [telegram_bot_test] 
✅ 测试完成！

📊 检查项总数:
  • 环境变量: 6
  • 依赖库: 7
  • 文件检查: 5
  • 配置检查: 2
  • 量化系统: 2
  • 命令处理器: 14
  • 错误处理: 5
  • 安全特性: 4

📄 报告位置: telegram_bot_test_report_20251018_113804.txt

🎯 接下来的步骤:
  1. 查看生成的测试报告
  2. 根据报告修复任何缺失的配置
  3. 运行 'python start_telegram_bot.py' 启动 Bot
  4. 使用 'python test_bot_connection.py' 测试连接
    

================================================================================
📊 Telegram Bot 综合测试报告
================================================================================
生成时间: 2025-10-18 11:38:04

================================================================================
🔹 环境检查结果
================================================================================

### 环境变量
  • TELEGRAM_BOT_TOKEN:
      状态: ✅ 已配置
      值: 7180490983:AAFbkKnDP...
  • TELEGRAM_ADMIN_CHAT_ID:
      状态: ❌ 未配置
      值: N/A
  • TG_ALLOWED_USER_IDS:
      状态: ✅ 已配置
      值: 1005293427...
  • TG_ALLOWED_CHAT_IDS:
      状态: ⚠️  未配置
      值: N/A
  • CURSOR_API_KEY:
      状态: ✅ 已配置
      值: key_76c8863c1381ccf5...
  • BOT_SINGLETON_PORT:
      状态: ⚠️  未配置
      值: N/A

### 依赖库
  • python-telegram-bot:
      状态: ✅ 已安装
      类型: 必需
  • python-dotenv:
      状态: ✅ 已安装
      类型: 必需
  • pandas:
      状态: ✅ 已安装
      类型: 必需
  • numpy:
      状态: ✅ 已安装
      类型: 必需
  • requests:
      状态: ✅ 已安装
      类型: 必需
  • playwright:
      状态: ⚠️  未安装
      类型: 可选
  • httpx:
      状态: ✅ 已安装
      类型: 可选

### 文件检查
  • telegram_quant_bot.py:
      状态: ✅ 存在
      大小: 42668 bytes
  • config/bot.env:
      状态: ✅ 存在
      大小: 102 bytes
  • TELEGRAM_BOT_README.md:
      状态: ✅ 存在
      大小: 4459 bytes
  • start_telegram_bot.py:
      状态: ✅ 存在
      大小: 1114 bytes
  • test_bot_connection.py:
      状态: ✅ 存在
      大小: 3633 bytes

### 配置检查
  • bot.env:
      状态: ✅ 可读
      行数: 2
      是否有效: True
  • telegram_bot.env.example:
      状态: ✅ 可读
      行数: 13
      包含示例: True
================================================================================
🔹 功能验证结果
================================================================================

### 量化系统
  • 导入状态: ✅ 成功导入核心函数
  • 可用函数:
      get_stock_data: ✅
      calculate_technical_indicators: ✅
      calculate_risk_metrics: ✅

### 命令处理器
  • /start: ✅ 已实现
  • /help: ✅ 已实现
  • /analyze: ✅ 已实现
  • /optimize: ✅ 已实现
  • /risk: ✅ 已实现
  • /sentiment: ✅ 已实现
  • /status: ✅ 已实现
  • /id: ✅ 已实现
  • /echo: ✅ 已实现
  • /history: ✅ 已实现
  • /summary: ✅ 已实现
  • /cursor: ✅ 已实现
  • /wsl: ✅ 已实现
  • /tftcap: ✅ 已实现

### 错误处理
  • 异常处理: ✅ 已实现
  • 错误处理器: ✅ 已实现
  • 速率限制: ✅ 已实现
  • 单实例锁: ✅ 已实现
  • Webhook清理: ✅ 已实现

### 安全特性
  • 用户白名单: ✅ 已实现
  • 环境变量: ✅ 已实现
  • 密钥隐藏: ✅ 已实现
  • 权限检查: ✅ 已实现

================================================================================
📈 测试统计
================================================================================
总检查项数: 45
成功项数: 17
成功率: 17/45 (37%)
