# å¯Œé€”ç‰›ç‰›APIé›†æˆæŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°†å¯Œé€”ç‰›ç‰›APIé›†æˆåˆ°é‡åŒ–äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨DEMOç¯å¢ƒè¿›è¡Œå®‰å…¨æµ‹è¯•ã€‚

âš ï¸ **é‡è¦æé†’**ï¼š
- æ‰€æœ‰æµ‹è¯•å‡ä½¿ç”¨DEMOç¯å¢ƒ (SIMULATE)
- ä½¿ç”¨æ¨¡æ‹Ÿèµ„é‡‘ï¼Œä¸ä¼šé€ æˆçœŸå®æŸå¤±
- ä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨

---

## ğŸ“‹ å‰ç½®æ¡ä»¶

### 1. å®‰è£…å¯Œé€”API

```bash
pip install futu-api
```

### 2. ä¸‹è½½FutuOpenDç½‘å…³å®¢æˆ·ç«¯

- è®¿é—®ï¼šhttps://www.futunn.com/download/openAPI
- ä¸‹è½½å¹¶å®‰è£…Windows/Mac/Linuxç‰ˆæœ¬
- å¯åŠ¨FutuOpenDå®¢æˆ·ç«¯

### 3. é…ç½®DEMOè´¦æˆ·

1. æ‰“å¼€FutuOpenDå®¢æˆ·ç«¯
2. ç™»å½•DEMOè´¦æˆ·ï¼ˆæ¨¡æ‹Ÿè´¦æˆ·ï¼‰
3. ç¡®è®¤è¿æ¥åˆ°ç«¯å£11111

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¯Œé€”APIé›†æˆäº¤æ˜“ç³»ç»Ÿ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Signal Manager       â”‚  RealtimeExecutionEngine        â”‚
â”‚  - Technical Signals  â”‚  - Risk Manager                 â”‚
â”‚  - Signal Config      â”‚  - Order Monitor                â”‚
â”‚  - Signal History     â”‚  - Performance Stats            â”‚
â”‚                       â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç­–ç•¥é…ç½®         â”‚  â”‚  â”‚ é£é™©æ§åˆ¶                  â”‚  â”‚
â”‚  â”‚ - RSI           â”‚  â”‚  â”‚ - æœ€å¤§æŒä»“                â”‚  â”‚
â”‚  â”‚ - MACD          â”‚  â”‚  â”‚ - æœ€å¤§è®¢å•                â”‚  â”‚
â”‚  â”‚ - MA Crossover  â”‚  â”‚  â”‚ - æ—¥å†…æŸå¤±                â”‚  â”‚
â”‚  â”‚ - Bollinger     â”‚  â”‚  â”‚ - ç°é‡‘å‚¨å¤‡                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                 â”‚
â”‚                       â”‚  å¯Œé€”äº¤æ˜“API                    â”‚
â”‚                       â”‚  - FutuTradingAPI              â”‚
â”‚                       â”‚  - DEMOç¯å¢ƒ                    â”‚
â”‚                       â”‚  - çœŸå®è®¢å•æ‰§è¡Œ                â”‚
â”‚                       â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¯Œé€”ç½‘å…³å®¢æˆ·ç«¯     â”‚
                    â”‚  FutuOpenD        â”‚
                    â”‚  - DEMOè´¦æˆ·        â”‚
                    â”‚  - ç«¯å£11111       â”‚
                    â”‚  - è¡Œæƒ…æ•°æ®        â”‚
                    â”‚  - äº¤æ˜“æ¥å£        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. å¯Œé€”äº¤æ˜“API (`futu_trading_api.py`)

#### åŠŸèƒ½ç‰¹æ€§
- âœ… å®Œæ•´çš„è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… çœŸå®å¸‚åœºæ•°æ®è·å–
- âœ… è´¦æˆ·å’ŒæŒä»“æŸ¥è¯¢
- âœ… è®¢å•çŠ¶æ€å®æ—¶ç›‘æ§
- âœ… å†å²æ•°æ®è·å–
- âœ… DEMOç¯å¢ƒæ”¯æŒ

#### ä¸»è¦æ–¹æ³•
```python
# è¿æ¥å’Œè®¤è¯
await api.connect()                    # è¿æ¥API
await api.authenticate({'trade_password': '123456'})  # è§£é”äº¤æ˜“

# è´¦æˆ·å’ŒæŒä»“
await api.get_account_info()           # è´¦æˆ·ä¿¡æ¯
await api.get_positions()              # æŒä»“åˆ—è¡¨

# å¸‚åœºæ•°æ®
await api.get_market_data(symbol)      # å®æ—¶è¡Œæƒ…
await api.get_historical_data(...)     # å†å²æ•°æ®

# è®¢å•ç®¡ç†
await api.place_order(order)           # ä¸‹å•
await api.cancel_order(order_id)       # å–æ¶ˆè®¢å•
await api.get_order_status(order_id)   # è®¢å•çŠ¶æ€

# æ‰¹é‡æŸ¥è¯¢
await api.get_orders()                 # è®¢å•åˆ—è¡¨
```

#### é…ç½®å‚æ•°
```python
config = {
    'host': '127.0.0.1',        # ç½‘å…³åœ°å€
    'port': 11111,              # ç«¯å£
    'market': 'HK',             # å¸‚åœº: HK/US/CN
    'trade_password': '123456'  # DEMOäº¤æ˜“å¯†ç 
}
```

### 2. çœŸå®äº¤æ˜“ç³»ç»Ÿ (`futu_live_trading_system.py`)

#### ä¸»è¦åŠŸèƒ½
- è‡ªåŠ¨äº¤æ˜“æ‰§è¡Œ
- é£é™©ç®¡ç†
- å®æ—¶ç›‘æ§
- æ‰‹åŠ¨äº¤æ˜“æ¥å£

#### ä½¿ç”¨ç¤ºä¾‹
```python
# åˆå§‹åŒ–
trading_system = FutuLiveTradingSystem(config)
await trading_system.initialize()

# æ·»åŠ ä¿¡å·é…ç½®
await trading_system.add_signal_config(
    SignalConfig('00700.HK', 'rsi', {
        'period': 14,
        'oversold': 30,
        'overbought': 70
    })
)

# å¯åŠ¨äº¤æ˜“
await trading_system.start_trading(enable_auto_trading=True)

# æ‰‹åŠ¨äº¤æ˜“
order_id = await trading_system.manual_trade(
    symbol='00700.HK',
    side='buy',
    quantity=100,
    price=400.0
)

# è·å–çŠ¶æ€
status = await trading_system.get_status()
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€è¿æ¥æµ‹è¯•

```python
import asyncio
from futu_trading_api import create_futu_trading_api

async def test_connection():
    # åˆ›å»ºAPIå®ä¾‹
    api = create_futu_trading_api(
        host='127.0.0.1',
        port=11111,
        market='HK'
    )

    # è¿æ¥
    await api.connect()
    print("è¿æ¥æˆåŠŸ")

    # è®¤è¯ (DEMOç¯å¢ƒ)
    await api.authenticate({'trade_password': '123456'})
    print("è®¤è¯æˆåŠŸ")

    # è·å–è´¦æˆ·ä¿¡æ¯
    account = await api.get_account_info()
    print(f"è´¦æˆ·ç°é‡‘: ${account.cash}")

    # æ–­å¼€
    await api.disconnect()

asyncio.run(test_connection())
```

### 2. ä¸‹å•æµ‹è¯•

```python
async def test_order():
    api = create_futu_trading_api()
    await api.connect()
    await api.authenticate({'trade_password': '123456'})

    # åˆ›å»ºè®¢å•
    from base_trading_api import Order, OrderType, OrderSide
    from decimal import Decimal

    order = Order(
        order_id="TEST_001",
        symbol="00700.HK",
        side=OrderSide.BUY,
        order_type=OrderType.LIMIT,
        quantity=Decimal('100'),
        price=Decimal('400.0')
    )

    # ä¸‹å•
    order_id = await api.place_order(order)
    print(f"è®¢å•ID: {order_id}")

    # ç­‰å¾…å¹¶æŸ¥çœ‹çŠ¶æ€
    await asyncio.sleep(3)
    status = await api.get_order_status(order_id)
    print(f"è®¢å•çŠ¶æ€: {status}")

asyncio.run(test_order())
```

### 3. å®Œæ•´äº¤æ˜“ç³»ç»Ÿ

```python
import asyncio
from futu_live_trading_system import FutuLiveTradingSystem
from signal_generator import SignalConfig

async def main():
    config = {
        'futu': {
            'host': '127.0.0.1',
            'port': 11111,
            'trade_password': '123456'
        },
        'risk': {
            'max_position_size': 500000,
            'max_order_size': 100000
        },
        'scan_interval': 60
    }

    # åˆ›å»ºç³»ç»Ÿ
    system = FutuLiveTradingSystem(config)

    # åˆå§‹åŒ–
    if await system.initialize():
        print("ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")

        # æ·»åŠ ä¿¡å·
        await system.add_signal_config(
            SignalConfig('00700.HK', 'rsi', {'period': 14})
        )

        # è·å–çŠ¶æ€
        status = await system.get_status()
        print(json.dumps(status, indent=2, default=str))

        # æ‰‹åŠ¨äº¤æ˜“æµ‹è¯•
        order_id = await system.manual_trade(
            '00700.HK', 'buy', 100, 400.0
        )

        # æ¸…ç†
        await system.cleanup()

asyncio.run(main())
```

---

## ğŸ“Š æ”¯æŒçš„è®¢å•ç±»å‹

### 1. å¸‚ä»·å• (MARKET)
```python
order = Order(
    order_id="MKT_001",
    symbol="00700.HK",
    side=OrderSide.BUY,
    order_type=OrderType.MARKET,
    quantity=Decimal('100')
)
```

### 2. é™ä»·å• (LIMIT)
```python
order = Order(
    order_id="LMT_001",
    symbol="00700.HK",
    side=OrderSide.BUY,
    order_type=OrderType.LIMIT,
    quantity=Decimal('100'),
    price=Decimal('400.0')
)
```

---

## ğŸ¯ æ”¯æŒçš„è‚¡ç¥¨ä»£ç 

### æ¸¯è‚¡
- `00700.HK` - è…¾è®¯æ§è‚¡
- `0388.HK` - é¦™æ¸¯äº¤æ˜“æ‰€
- `1398.HK` - ä¸­å›½å·¥å•†é“¶è¡Œ
- `0939.HK` - ä¸­å›½å»ºè®¾é“¶è¡Œ
- `3988.HK` - ä¸­å›½é“¶è¡Œ

### ä»£ç æ ¼å¼è½¬æ¢
```python
# ç³»ç»Ÿæ ¼å¼ -> å¯Œé€”æ ¼å¼
"00700.HK" -> "HK.00700"
"00700.US" -> "US.00700"

# å¯Œé€”æ ¼å¼ -> ç³»ç»Ÿæ ¼å¼
"HK.00700" -> "00700.HK"
"US.00700" -> "00700.US"
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### å®Œæ•´é…ç½®ç¤ºä¾‹
```python
config = {
    # å¯Œé€”APIé…ç½®
    'futu': {
        'host': '127.0.0.1',              # ç½‘å…³åœ°å€
        'port': 11111,                    # ç«¯å£
        'market': 'HK',                   # å¸‚åœº
        'trade_password': '123456'        # äº¤æ˜“å¯†ç 
    },

    # è®¤è¯é…ç½®
    'auth': {
        'trade_password': '123456'        # DEMOå¯†ç 
    },

    # é£é™©æ§åˆ¶
    'risk': {
        'max_position_size': 500000,      # æœ€å¤§æŒä»“
        'max_daily_loss': 50000,          # æœ€å¤§æ—¥å†…æŸå¤±
        'max_order_size': 100000,         # æœ€å¤§è®¢å•
        'min_cash_reserve': 10000         # æœ€å°ç°é‡‘å‚¨å¤‡
    },

    # ç³»ç»Ÿè®¾ç½®
    'scan_interval': 60,                  # æ‰«æé—´éš”(ç§’)
    'auto_trading': False                 # æ˜¯å¦å¯ç”¨è‡ªåŠ¨äº¤æ˜“
}
```

---

## ğŸ§ª æµ‹è¯•è„šæœ¬

### 1. åŸºç¡€è¿æ¥æµ‹è¯•
```bash
cd src/trading
python test_futu_trading.py
```

### 2. å®Œæ•´äº¤æ˜“ç³»ç»Ÿæµ‹è¯•
```bash
cd src/trading
python futu_live_trading_system.py
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### DEMOç¯å¢ƒé™åˆ¶
1. **ä»…æ¨¡æ‹Ÿäº¤æ˜“**ï¼šä½¿ç”¨è™šæ‹Ÿèµ„é‡‘ï¼Œä¸ä¼šé€ æˆçœŸå®æŸå¤±
2. **å¸‚åœºæ—¶é—´**ï¼šå³ä½¿å¸‚åœºå…³é—­ä¹Ÿå¯ä»¥ä¸‹å•ï¼ˆæ¨¡æ‹Ÿï¼‰
3. **æ•°æ®å»¶è¿Ÿ**ï¼šDEMOç¯å¢ƒæ•°æ®å¯èƒ½æœ‰å»¶è¿Ÿ
4. **è®¢å•é™åˆ¶**ï¼šéƒ¨åˆ†é«˜çº§è®¢å•ç±»å‹å¯èƒ½ä¸æ”¯æŒ

### å®‰å…¨å»ºè®®
1. **æµ‹è¯•ä¼˜å…ˆ**ï¼šå…ˆåœ¨DEMOç¯å¢ƒå……åˆ†æµ‹è¯•
2. **å°é¢å¼€å§‹**ï¼šå®ç›˜äº¤æ˜“æ—¶ä»å°é¢å¼€å§‹
3. **é£é™©æ§åˆ¶**ï¼šå§‹ç»ˆè®¾ç½®é£é™©å‚æ•°
4. **å®šæœŸç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥è®¢å•çŠ¶æ€å’Œè´¦æˆ·

### æ•…éšœæ’é™¤

#### 1. è¿æ¥å¤±è´¥
```
é”™è¯¯ï¼šè¿æ¥è¢«æ‹’ç»
è§£å†³ï¼š
- æ£€æŸ¥FutuOpenDæ˜¯å¦å¯åŠ¨
- ç¡®è®¤ç«¯å£11111æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
```

#### 2. è®¤è¯å¤±è´¥
```
é”™è¯¯ï¼šè§£é”å¤±è´¥
è§£å†³ï¼š
- ç¡®è®¤DEMOè´¦æˆ·å¯†ç 
- æ£€æŸ¥æ˜¯å¦å·²ç™»å½•DEMOè´¦æˆ·
- é‡å¯FutuOpenDå®¢æˆ·ç«¯
```

#### 3. ä¸‹å•å¤±è´¥
```
é”™è¯¯ï¼šä¸‹å•å¤±è´¥
å¯èƒ½åŸå› ï¼š
- DEMOè´¦æˆ·ä½™é¢ä¸è¶³
- ä»·æ ¼è¶…å‡ºæœ‰æ•ˆèŒƒå›´
- å¸‚åœºæœªå¼€ç›˜
- è‚¡ç¥¨ä»£ç é”™è¯¯
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. è¿æ¥æ± 
```python
# ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†è¿æ¥
class FutuAPIManager:
    _instance = None
    _api = None

    @classmethod
    async def get_api(cls):
        if not cls._api:
            cls._api = create_futu_trading_api()
            await cls._api.connect()
        return cls._api
```

### 2. ç¼“å­˜å¸‚åœºæ•°æ®
```python
# ç¼“å­˜å¸‚åœºå¿«ç…§ï¼Œå‡å°‘APIè°ƒç”¨
class MarketDataCache:
    def __init__(self):
        self.cache = {}
        self.last_update = {}

    async def get_market_data(self, symbol):
        if self._is_cache_valid(symbol):
            return self.cache[symbol]
        data = await self.api.get_market_data(symbol)
        self._update_cache(symbol, data)
        return data
```

### 3. å¼‚æ­¥å¹¶å‘
```python
# å¹¶å‘è·å–å¤šä¸ªè‚¡ç¥¨æ•°æ®
symbols = ['00700.HK', '0388.HK', '1398.HK']
tasks = [api.get_market_data(s) for s in symbols]
results = await asyncio.gather(*tasks)
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [å¯Œé€”OpenAPIå®˜æ–¹æ–‡æ¡£](https://openapi.futunn.com/futu-api-doc/)
- [FutuOpenDä¸‹è½½](https://www.futunn.com/download/openAPI)
- [å¯Œé€”API GitHub](https://github.com/Futunnopen/py-futu-api)

---

## ğŸ‰ æ€»ç»“

å¯Œé€”ç‰›ç‰›APIé›†æˆä¸ºé‡åŒ–äº¤æ˜“ç³»ç»Ÿæä¾›äº†ï¼š

1. **çœŸå®äº¤æ˜“èƒ½åŠ›**ï¼šä½¿ç”¨çœŸå®å¸‚åœºæ•°æ®è¿›è¡Œäº¤æ˜“
2. **DEMOç¯å¢ƒ**ï¼šå®‰å…¨æµ‹è¯•ï¼Œæ— çœŸå®é£é™©
3. **å®Œæ•´æ¥å£**ï¼šè¦†ç›–è¡Œæƒ…ã€äº¤æ˜“ã€è´¦æˆ·ç­‰æ‰€æœ‰åŠŸèƒ½
4. **æ˜“äºé›†æˆ**ï¼šç»Ÿä¸€æ¥å£ï¼Œæ— ç¼æ¥å…¥ç°æœ‰ç³»ç»Ÿ

**ç«‹å³å¼€å§‹ä½¿ç”¨å¯Œé€”APIè¿›è¡ŒçœŸå®äº¤æ˜“ï¼** ğŸš€
