# LIHKG 財經台爬蟲與散戶情緒分析提案

## 變更概要

**變更 ID:** add-lihkg-sentiment-scraper

**版本:** 1.0

**創建日期:** 2025-10-27

**作者:** Claude Code

**類型:** Feature Enhancement

---

## 背景

LIHKG 是香港知名的討論區，其財經台（category/2：股票；category/15：期貨）聚集了大量散戶投資者的討論和觀點。挖掘這些討論內容對於量化交易系統具有重要價值：

1. **散戶情緒指標**：散戶情緒是反向指標，極端情緒往往預示市場轉折點
2. **熱門股票追蹤**：散戶關注度高的股票往往是市場焦點
3. **輿論分析**：通過討論熱度和觀點分析市場趨勢
4. **風險評估**：識別潛在的市場風險和機會

當前系統缺乏對社交媒體和論壇數據的挖掘能力，無法利用這些寶貴的散戶情緒數據。

---

## Why

### 業務驅動因素

1. **情緒投資策略需求**
   - 香港散戶投資者習慣在 LIHKG 討論股票和期貨
   - 這些討論反映了真實的市場情緒和預期
   - 散戶情緒往往是反向指標，可用作交易信號

2. **量化數據來源拓展**
   - 傳統量化分析主要基於價格和成交量數據
   - 情緒數據可以補充傳統技術分析，提供更全面的市場視角
   - 增強策略的預測能力和風險識別

3. **實時市場監控**
   - LIHKG 討論往往早於市場反應
   - 通過監控討論熱度可以提前預測市場變化
   - 為風險管理和機會把握提供早期預警

### 技術驅動因素

1. **Chrome DevTools MCP 成熟**
   - 項目已集成 Chrome MCP 瀏覽器自動化能力
   - 可以動態分析 LIHKG 頁面結構和動態載入內容
   - 為複雜的討論區數據提取提供技術基礎

2. **自然語言處理整合**
   - 現有系統已有 `sentiment_analyzer.py` 模塊
   - 可以利用現有的情緒分析能力處理 LIHKG 內容
   - 構建完整的數據採集 → 處理 → 分析流程

3. **模塊化架構**
   - 現有 `gov_crawler` 框架提供良好的參考
   - 數據適配器模式易於擴展
   - 為多數據源爬取系統提供架構基礎

---

## 目標

### 主要目標

1. **LIHKG 財經台爬取**
   - 爬取 category/2（股票討論）
   - 爬取 category/15（期貨討論）
   - 獲取帖子標題、內容、回復數、查看數、時間等

2. **散戶情緒分析**
   - 分析帖子標題和內容的情緒傾向
   - 計算討論熱度和關注度指標
   - 識別高熱度討論的股票代碼

3. **Chrome MCP 自動化測試**
   - 使用 Chrome MCP 驗證爬蟲功能
   - 自動檢測網頁結構變化
   - 確保數據提取的穩定性和準確性

### 次要目標

1. **數據存儲和管理**
   - 將爬取數據存儲到 SQLite 資料庫
   - 實現數據去重和更新機制
   - 提供歷史數據查詢和導出功能

2. **API 整合**
   - 提供 RESTful API 供其他模塊調用
   - 整合到現有的量化交易系統
   - 支持實時情緒指標查詢

3. **監控和告警**
   - 監控爬蟲運行狀態
   - 異常情況告警
   - 數據質量檢查和報告

---

## 詳細需求

### 數據欄位

每個爬取的帖子需包含以下欄位：

```json
{
  "post_id": "帖子唯一 ID",
  "category": "板塊 (2 或 15)",
  "title": "帖子標題",
  "content": "帖子內容摘要",
  "author": "發帖者",
  "replies": "回復數量",
  "views": "查看數",
  "likes": "點贊數",
  "post_time": "發帖時間",
  "tags": "標籤列表",
  "sentiment_score": "情緒分數 (-1 到 1)",
  "stock_mentions": "提及的股票代碼列表",
  "created_at": "數據採集時間"
}
```

### 功能模塊

1. **LIHKG 爬蟲引擎**
   - 使用 Chrome MCP 控制瀏覽器
   - 處理分頁和動態載入
   - 實現速率限制和錯誤重試

2. **情緒分析模塊**
   - 整合現有 `sentiment_analyzer.py`
   - 支持中文繁體和簡體情緒分析
   - 計算情緒強度和極性

3. **股票代碼識別**
   - 正則表達式匹配股票代碼（格式：XXXX.HK）
   - 識別討論主題股票
   - 統計股票被提及次數

4. **數據存儲模塊**
   - SQLite 資料庫存儲
   - 數據去重機制
   - 增量更新策略

---

## 驗收標準

1. **功能性驗收**
   - [ ] 能夠成功爬取 category/2 和 category/15 的帖子
   - [ ] 每個帖子包含所有必需欄位
   - [ ] 情緒分析功能正常工作
   - [ ] 股票代碼識別準確率 > 80%

2. **性能驗收**
   - [ ] 爬取速度：每分鐘 ≥ 50 個帖子
   - [ ] 數據準確性：重複率 < 5%
   - [ ] 系統穩定性：連續運行 24 小時無崩潰

3. **Chrome MCP 驗收**
   - [ ] 使用 Chrome MCP 成功載入 LIHKG 頁面
   - [ ] 自動檢測頁面元素和選擇器
   - [ ] 處理動態內容載入
   - [ ] 生成驗證報告

4. **API 驗收**
   - [ ] 提供 `/api/lihkg/posts` 獲取帖子列表
   - [ ] 提供 `/api/lihkg/sentiment` 獲取情緒分析結果
   - [ ] 提供 `/api/lihkg/stocks` 獲取熱門股票
   - [ ] 所有 API 響應時間 < 500ms

---

## 風險評估

### 技術風險

1. **網站結構變更**
   - LIHKG 可能更新頁面結構，導致爬蟲失效
   - **緩解方案**：使用 Chrome MCP 自動檢測變更，實現智能選擇器發現

2. **反爬蟲機制**
   - LIHKG 可能實施訪問頻率限制
   - **緩解方案**：實現速率限制和隨機延遲

3. **動態內容載入**
   - LIHKG 使用 JavaScript 動態載入內容
   - **緩解方案**：使用 Chrome MCP 全功能瀏覽器渲染

### 合規風險

1. **版權問題**
   - 帖子內容受版權保護
   - **緩解方案**：僅用於學術研究和內部分析，不對外發布

2. **隱私問題**
   - 討論內容包含個人信息
   - **緩解方案**：不存儲個人身份信息，僅分析情緒指標

### 業務風險

1. **數據質量**
   - 情緒分析準確性依賴訓練數據
   - **緩解方案**：持續優化情緒分析模型

2. **實時性**
   - 爬蟲延遲可能影響信號有效性
   - **緩解方案**：實現準實時監控和告警

---

## 實施計劃

### 階段 1：基礎框架 (1-2 天)
- [ ] 設計 LIHKG 爬蟲架構
- [ ] 創建 OpenSpec 提案
- [ ] 設置 Chrome MCP 測試環境
- [ ] 實現基礎爬蟲框架

### 階段 2：核心功能 (2-3 天)
- [ ] 實現 LIHKG 頁面爬取邏輯
- [ ] 整合情緒分析功能
- [ ] 實現股票代碼識別
- [ ] 數據存儲和管理

### 階段 3：測試與優化 (1-2 天)
- [ ] 使用 Chrome MCP 進行測試
- [ ] 性能優化和錯誤處理
- [ ] API 開發和整合
- [ ] 生成測試報告

### 階段 4：部署與監控 (1 天)
- [ ] 集成到主系統
- [ ] 設置監控和告警
- [ ] 文檔編寫
- [ ] 驗收測試

---

## 技術棧

- **瀏覽器自動化**: Chrome DevTools MCP
- **爬蟲框架**: 定制 Python 爬蟲
- **情緒分析**: 現有 sentiment_analyzer.py
- **數據存儲**: SQLite
- **API 框架**: FastAPI
- **前端整合**: JavaScript/AJAX

---

## 成功指標

1. **數據覆蓋率**: 成功爬取目標板塊 95% 以上的帖子
2. **情緒分析準確性**: 與人工標註的一致性 > 80%
3. **股票識別準確性**: 股票代碼識別準確率 > 80%
4. **系統穩定性**: 7×24 小時穩定運行
5. **響應速度**: API 響應時間 < 500ms

---

## 後續擴展

1. **更多數據源**
   - 整合其他香港論壇和社交媒體
   - 支持更多金融討論區

2. **高級情緒分析**
   - 觀點挖掘和主題建模
   - 情緒強度量化

3. **預測模型**
   - 基於情緒數據的價格預測模型
   - 散戶情緒指數開發

4. **實時監控**
   - 實時情緒指數儀表板
   - 異常情緒告警機制

---

**作者:** Claude Code  
**日期:** 2025-10-27  
**版本:** 1.0
