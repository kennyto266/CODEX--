# CODEX 量化交易系统 - 用户手册

## 目录

1. [系统概述](#1-系统概述)
2. [系统架构](#2-系统架构)
3. [功能模块](#3-功能模块)
4. [操作指南](#4-操作指南)
5. [API接口](#5-api接口)
6. [常见问题](#6-常见问题)
7. [技术支持](#7-技术支持)

---

## 1. 系统概述

### 1.1 产品简介

CODEX 量化交易系统是一个完整的、生产级的量化交易平台，集成了先进的人工智能、多智能体协作、实时风险管理和专业级交易执行能力。

**主要特性**:
- 🤖 **7个AI Agent协作** - 自动化智能决策
- 📊 **实时数据分析** - 多维度市场监控
- 🛡️ **风险控制系统** - 全方位风险管控
- 📈 **策略回测引擎** - 科学策略验证
- 💰 **多账户交易** - 支持美股/港股
- 🎯 **Web仪表板** - 直观可视化界面

### 1.2 技术架构

#### 后端技术栈
- **Python 3.13+** - 核心开发语言
- **FastAPI** - 高性能API框架
- **SQLAlchemy** - 数据库ORM
- **SQLite** - 轻量级数据库
- **Pydantic** - 数据验证
- **AsyncIO** - 异步编程

#### 前端技术栈
- **Vue 3.3.4** - 现代化前端框架
- **Pinia 2.1.6** - 状态管理
- **Vue Router 4.2.5** - 路由管理
- **Vite 5.0.0** - 构建工具
- **TailwindCSS** - 样式框架

### 1.3 系统优势

| 优势 | 描述 |
|------|------|
| 🚀 **高性能** | API响应 < 100ms，前端加载 < 1s |
| 🛡️ **高安全** | 多层安全防护，完整的权限控制 |
| 📈 **可扩展** | 模块化架构，支持水平扩展 |
| 🎯 **易使用** | Web界面直观，操作简单 |
| 🔧 **易维护** | 完整日志记录，故障快速定位 |

---

## 2. 系统架构

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端展示层                               │
├─────────────────────────────────────────────────────────────────┤
│  Vue 3 Dashboard  │  WebSocket  │  RESTful API  │  文档中心    │
└─────────────────────────────────────────────────────────────────┘
                                ↕
┌─────────────────────────────────────────────────────────────────┐
│                        后端服务层                               │
├─────────────────────────────────────────────────────────────────┤
│  FastAPI  │  Agent Manager  │  Risk Manager  │  Trade Engine   │
└─────────────────────────────────────────────────────────────────┘
                                ↕
┌─────────────────────────────────────────────────────────────────┐
│                        数据访问层                               │
├─────────────────────────────────────────────────────────────────┤
│  Data Adapters  │  Cache Manager  │  Database ORM  │  Message   │
└─────────────────────────────────────────────────────────────────┘
                                ↕
┌─────────────────────────────────────────────────────────────────┐
│                        外部集成层                               │
├─────────────────────────────────────────────────────────────────┤
│  富途API  │  HKEX API  │  GOV数据  │  替代数据  │  第三方服务  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心组件

#### 2.2.1 多Agent系统
系统包含7个专业AI Agent：

| Agent | 职责 | 功能 |
|-------|------|------|
| 🎯 **Coordinator** | 工作流协调 | 协调所有Agent工作流程和消息传递 |
| 📊 **Data Scientist** | 数据分析 | 数据分析和异常检测 |
| 📈 **Quantitative Analyst** | 量化分析 | 量化分析和蒙特卡洛模拟 |
| ⚙️ **Quantitative Engineer** | 系统优化 | 系统监控和性能优化 |
| 💼 **Portfolio Manager** | 组合管理 | 投资组合管理和风险预算 |
| 🔍 **Research Analyst** | 策略研究 | 策略研究和回测验证 |
| 🛡️ **Risk Analyst** | 风险评估 | 风险评估和对冲策略 |

#### 2.2.2 数据源
- **实时行情**: HKEX API
- **宏观经济**: GOV数据 (35个指标)
- **交易数据**: 富途API
- **历史数据**: 本地数据库

---

## 3. 功能模块

### 3.1 Agent管理

#### 3.1.1 功能介绍
- 实时监控7个AI Agent的运行状态
- 查看每个Agent的消息处理量
- 控制Agent的启动/停止/重启
- 查看Agent的CPU和内存使用率

#### 3.1.2 操作步骤
1. 点击左侧导航栏「🤖 Agents」
2. 查看Agent列表和状态
3. 点击「Stop」按钮可停止单个Agent
4. 点击「Logs」按钮可查看Agent日志
5. 使用顶部控制按钮可批量操作

#### 3.1.3 状态说明
- 🟢 **Running**: Agent正常运行
- 🔴 **Stopped**: Agent已停止
- 🟡 **Starting**: Agent启动中
- ⚫ **Error**: Agent出现错误

### 3.2 任务看板

#### 3.2.1 功能介绍
- 查看所有任务的统计信息
- 按优先级分类显示任务
- 跟踪任务完成进度
- 支持快速筛选和搜索

#### 3.2.2 操作步骤
1. 点击左侧导航栏「📋 Tasks」
2. 查看任务统计面板
3. 使用过滤器筛选任务
4. 点击任务卡片查看详情
5. 点击「打开任务看板」查看完整看板

#### 3.2.3 优先级说明
- **P0 (关键路径)**: 最高优先级，必须优先完成
- **P1 (重要)**: 次高优先级，影响系统核心功能
- **P2 (一般)**: 常规优先级，锦上添花的功能

### 3.3 策略回测

#### 3.3.1 功能介绍
- 支持多种技术指标策略
- 可配置回测参数
- 生成详细的回测报告
- 支持参数优化

#### 3.3.2 支持的策略
- **基础指标**:
  - MA (移动平均)
  - RSI (相对强弱指数)
  - MACD (指数平滑异同平均)
  - BB (布林带)

- **高级指标**:
  - KDJ (随机指标)
  - CCI (商品通道指数)
  - ADX (平均趋向指数)
  - ATR (真实波动幅度均值)
  - OBV (能量潮)
  - Ichimoku (一目均衡表)
  - Parabolic SAR (抛物线转向)

#### 3.3.3 操作步骤
1. 点击左侧导航栏「📈 Backtest」
2. 填写股票代码 (如: 0700.HK)
3. 选择策略类型
4. 设置回测时间范围
5. 配置初始资金
6. 点击「🚀 Run Backtest」
7. 查看回测结果和图表

### 3.4 风险管理

#### 3.4.1 功能介绍
- 实时监控投资组合风险
- 计算VaR (风险价值)
- 评估最大回撤
- 生成风险报告

#### 3.4.2 风险指标
- **波动率**: 衡量价格波动程度
- **VaR**: 在险价值，95%置信度下的最大损失
- **ES**: 期望损失，超出VaR的平均损失
- **最大回撤**: 从峰值到谷值的最大跌幅
- **夏普比率**: 风险调整后收益

#### 3.4.3 操作步骤
1. 点击左侧导航栏「🛡️ Risk」
2. 查看风险统计面板
3. 查看风险指标图表
4. 查看持仓风险分布
5. 查看风险告警信息

### 3.5 交易执行

#### 3.5.1 功能介绍
- 实时查看持仓
- 下单交易
- 查看交易历史
- 修改订单

#### 3.5.2 支持的交易类型
- **限价单**: 指定价格买入/卖出
- **市价单**: 按当前市场价格成交
- **止损单**: 触发后按市价成交

#### 3.5.3 操作步骤
1. 点击左侧导航栏「💰 Trading」
2. 查看持仓列表
3. 点击「下单」按钮
4. 填写订单信息:
   - 股票代码
   - 交易方向 (买入/卖出)
   - 订单类型 (限价/市价/止损)
   - 数量
   - 价格 (限价单)
5. 点击「确认下单」
6. 查看订单状态

### 3.6 Dashboard总览

#### 3.6.1 功能介绍
- 系统整体状态概览
- 关键指标展示
- 快速访问入口
- 实时数据更新

#### 3.6.2 展示内容
- **初始资本**: 初始投资金额
- **投资组合价值**: 当前总资产
- **活跃持仓**: 正在持仓的股票数量
- **总收益率**: 累计收益率百分比

---

## 4. 操作指南

### 4.1 系统启动

#### 4.1.1 开发环境启动
```bash
# 1. 进入项目目录
cd /path/to/codex-quant-system

# 2. 激活虚拟环境
source .venv310/bin/activate  # Linux/Mac
# 或
.venv310\Scripts\activate  # Windows

# 3. 安装依赖
pip install -r requirements.txt

# 4. 启动完整系统 (推荐)
python complete_project_system.py

# 5. 或启动简单仪表板
python run_dashboard.py

# 6. 访问系统
# 主界面: http://localhost:8001
# API文档: http://localhost:8001/docs
```

#### 4.1.2 验证系统状态
1. 打开浏览器访问 http://localhost:8001
2. 确认所有7个Agent状态为「Running」
3. 查看Dashboard数据是否正常加载
4. 测试各个功能模块

### 4.2 日常操作

#### 4.2.1 监控Agent状态
1. 进入「Agents」页面
2. 查看「Active Agents」数量 (应为7)
3. 查看「System Health」百分比 (应为98%+)
4. 查看「Messages Processed」总数
5. 检查每个Agent的CPU和内存使用率

#### 4.2.2 查看交易数据
1. 进入「Trading」页面
2. 查看「持仓列表」
3. 查看「交易历史」
4. 查看「订单状态」
5. 确认数据实时更新

#### 4.2.3 运行策略回测
1. 进入「Backtest」页面
2. 选择股票代码 (如: 0700.HK)
3. 选择策略类型 (如: KDJ)
4. 设置回测期间 (如: 2022-01-01 到 2024-01-01)
5. 点击「Run Backtest」
6. 查看结果和图表

#### 4.2.4 检查风险指标
1. 进入「Risk」页面
2. 查看「Portfolio Risk」面板
3. 检查「VaR」值
4. 查看「Max Drawdown」
5. 查看「Sharpe Ratio」

### 4.3 高级操作

#### 4.3.1 参数优化
1. 在回测页面勾选「🔧 Optimize Parameters」
2. 系统会自动测试多种参数组合
3. 找到最优参数
4. 用最优参数进行回测验证

#### 4.3.2 查看Agent日志
1. 在「Agents」页面点击某个Agent的「Logs」按钮
2. 查看详细日志信息
3. 可复制日志内容进行问题诊断

#### 4.3.3 批量操作
1. 在「Agents」页面顶部控制面板
2. 使用「▶️ Start All Agents」启动所有Agent
3. 使用「⏹️ Stop All Agents」停止所有Agent
4. 使用「🔄 Restart All Agents」重启所有Agent
5. 使用「📋 View System Logs」查看系统日志

---

## 5. API接口

### 5.1 API文档

系统提供完整的RESTful API接口，API文档可通过以下方式访问：

- **交互式文档**: http://localhost:8000/docs
- **ReDoc文档**: http://localhost:8000/redoc
- **OpenAPI规范**: http://localhost:8000/openapi.json

### 5.2 认证方式

目前系统使用模拟认证，实际部署时需要配置API密钥。

### 5.3 基础URL

```
开发环境: http://localhost:8000
生产环境: https://your-domain.com
```

### 5.4 常用接口

#### 5.4.1 Agent管理

**获取Agent列表**
```http
GET /api/agents/list
```

**响应示例**:
```json
{
    "success": true,
    "data": [
        {
            "id": "coordinator",
            "name": "Coordinator Agent",
            "status": "running",
            "messages": 2845,
            "cpu_usage": 15,
            "memory_usage": 234
        }
    ]
}
```

**启动Agent**
```http
POST /api/agents/{agent_id}/start
```

**停止Agent**
```http
POST /api/agents/{agent_id}/stop
```

#### 5.4.2 交易相关

**获取持仓列表**
```http
GET /api/trading/positions
```

**响应示例**:
```json
{
    "success": true,
    "data": {
        "items": [
            {
                "symbol": "0700.HK",
                "quantity": 1000,
                "avg_price": 350.0,
                "current_price": 360.0,
                "pnl": 10000.0
            }
        ]
    }
}
```

**下单交易**
```http
POST /api/trading/order
Content-Type: application/json

{
    "symbol": "0700.HK",
    "order_type": "BUY",
    "quantity": 1000,
    "price": 350.0
}
```

#### 5.4.3 风险相关

**获取风险指标**
```http
GET /api/risk/metrics
```

**响应示例**:
```json
{
    "success": true,
    "data": {
        "portfolio_value": 1000000,
        "var_95": -0.0289,
        "expected_shortfall_95": -0.0360,
        "max_drawdown": 0.2551,
        "volatility": 0.3071,
        "sharpe_ratio": 0.6611
    }
}
```

#### 5.4.4 回测相关

**运行回测**
```http
POST /api/backtest/run
Content-Type: application/json

{
    "symbol": "0700.HK",
    "strategy": "kdj",
    "start_date": "2022-01-01",
    "end_date": "2024-01-01",
    "initial_capital": 1000000
}
```

### 5.5 错误处理

API使用标准HTTP状态码：

- `200` - 成功
- `400` - 请求错误
- `404` - 资源不存在
- `500` - 服务器错误

错误响应格式：
```json
{
    "success": false,
    "error": {
        "code": "INVALID_SYMBOL",
        "message": "股票代码格式不正确",
        "details": {}
    }
}
```

---

## 6. 常见问题

### 6.1 系统相关

**Q: 系统无法启动？**
A: 请检查：
1. Python版本是否为3.13+
2. 虚拟环境是否已激活
3. 依赖包是否正确安装
4. 端口8000是否被占用

**Q: Agent显示「Error」状态？**
A: 请检查：
1. 查看Agent日志获取详细错误信息
2. 重启该Agent
3. 如果问题持续，查看系统日志

**Q: 前端页面加载缓慢？**
A: 请检查：
1. 网络连接是否正常
2. 浏览器缓存是否需要清理
3. JavaScript是否启用
4. 防火墙是否阻止访问

### 6.2 交易相关

**Q: 无法下单？**
A: 请检查：
1. 股票代码格式是否正确 (如: 0700.HK)
2. 交易密码是否设置正确
3. 余额是否充足
4. 市场是否开放

**Q: 持仓数据不准确？**
A: 请检查：
1. 富途账户是否已登录
2. 网络连接是否稳定
3. 数据是否需要刷新 (点击刷新按钮)
4. 同步是否完成

### 6.3 回测相关

**Q: 回测运行失败？**
A: 请检查：
1. 股票代码是否存在
2. 时间范围是否合理
3. 策略参数是否正确
4. 数据是否足够

**Q: 回测结果异常？**
A: 请检查：
1. 策略参数设置
2. 交易成本设置
3. 数据质量
4. 是否选择了正确的基准

### 6.4 API相关

**Q: API调用返回400错误？**
A: 请检查：
1. 请求参数是否完整
2. 参数格式是否正确
3. Content-Type是否设置为application/json
4. JSON格式是否有效

**Q: API响应缓慢？**
A: 请检查：
1. 数据库连接是否正常
2. 是否有大量数据查询
3. 系统负载是否过高
4. 网络延迟

---

## 7. 技术支持

### 7.1 联系方式

- **技术支持邮箱**: support@codex-trading.com
- **用户社区**: https://community.codex-trading.com
- **文档中心**: https://docs.codex-trading.com

### 7.2 故障报告

如需报告故障，请提供以下信息：

1. **问题描述**: 详细描述遇到的问题
2. **复现步骤**: 逐步说明如何复现问题
3. **错误信息**: 完整的错误日志或截图
4. **环境信息**:
   - 操作系统
   - Python版本
   - 浏览器版本
   - 系统时间

### 7.3 更新日志

**版本 1.0.0 (2025-10-31)**
- ✨ 初始版本发布
- ✨ 支持7个AI Agent协作
- ✨ Vue 3仪表板界面
- ✨ 富途API交易集成
- ✨ 完整的风险管理系统
- ✨ 策略回测引擎

### 7.4 许可协议

本软件遵循 MIT 许可证，详见 LICENSE 文件。

---

**用户手册版本**: v1.0.0
**最后更新**: 2025-10-31
**文档维护**: CODEX开发团队

---

*感谢您选择 CODEX 量化交易系统！*
