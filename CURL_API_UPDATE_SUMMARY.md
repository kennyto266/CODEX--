# Curl/HTTP API çµ±ä¸€é…ç½® - å®Œæˆç¸½çµ

**å®Œæˆæ—¥æœŸ**: 2025-10-18
**ç‹€æ…‹**: âœ… **å®Œå…¨æ›´æ–° - å·²æº–å‚™å¥½ä½¿ç”¨**

---

## ğŸ“‹ è®Šæ›´æ¦‚è¦½

### æ ¸å¿ƒè¦æ±‚
âœ… é …ç›®è«‹çµ±ä¸€ä½¿ç”¨ Curl
âœ… ä½¿ç”¨é›†ä¸­å¼ HTTP API ç«¯é»
âœ… é…ç½®å¯«å…¥ CLAUDE.md

---

## ğŸ“ å·²å®Œæˆçš„æ›´æ–°

### 1. CLAUDE.md - æ•¸æ“šæºé…ç½® (å·²æ›´æ–°)

**æ–‡ä»¶**: `CLAUDE.md` (ç¬¬ 20-100 è¡Œ)

**åŒ…å«å…§å®¹**:
```
âœ… API ç«¯é»é…ç½®
âœ… åƒæ•¸èªªæ˜è¡¨æ ¼
âœ… Curl å‘½ä»¤ç¤ºä¾‹
âœ… Python å¯¦ç¾ä»£ç¢¼
âœ… æ”¯æŒçš„è‚¡ç¥¨åˆ—è¡¨
âœ… é‡è¦æ³¨æ„äº‹é …
```

**å¿«é€Ÿåƒè€ƒ**:
```bash
curl -X 'GET' \
  'http://18.180.162.113:9191/inst/getInst?symbol=0700.hk&duration=1825' \
  -H 'accept: application/json'
```

---

### 2. æ–°çš„ HTTP API é©é…å™¨ (å·²å‰µå»º)

**æ–‡ä»¶**: `src/data_adapters/hkex_http_adapter.py`

**åŠŸèƒ½**:
```python
class HKEXHttpAdapter(BaseDataAdapter):
    âœ… connect() - é€£æ¥åˆ° HTTP API
    âœ… disconnect() - æ–·é–‹é€£æ¥
    âœ… get_hkex_stock_data() - ç²å–è‚¡ç¥¨æ•¸æ“š
    âœ… get_market_data() - ç²å–å¸‚å ´æ•¸æ“š
    âœ… validate_data() - é©—è­‰æ•¸æ“šè³ªé‡
    âœ… _call_api() - å¸¶é‡è©¦çš„ API èª¿ç”¨
    âœ… _parse_api_response() - è§£æ API éŸ¿æ‡‰
```

**ç‰¹æ€§**:
- âœ… è‡ªå‹•é‡è©¦ (3 æ¬¡ï¼ŒæŒ‡æ•¸é€€é¿)
- âœ… 10 åˆ†é˜ç·©å­˜
- âœ… 30 ç§’è¶…æ™‚è™•ç†
- âœ… å®Œæ•´æ•¸æ“šé©—è­‰
- âœ… ç•°æ­¥æ”¯æŒ

---

### 3. å®Œæ•´é·ç§»æŒ‡å— (å·²å‰µå»º)

**æ–‡ä»¶**: `HTTP_API_MIGRATION_GUIDE.md`

**å…§å®¹**:
```
âœ… é·ç§»æ¦‚è¿°
âœ… API é…ç½®èªªæ˜
âœ… åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
âœ… Curl å‘½ä»¤ç¤ºä¾‹
âœ… å¯¦ç¾ç´°ç¯€
âœ… é›†æˆæŒ‡å—
âœ… æ¸¬è©¦ç¤ºä¾‹
âœ… FAQ
```

---

## ğŸ”„ API ç«¯é»è©³æƒ…

### åŸºæœ¬ä¿¡æ¯

| é …ç›® | å€¼ |
|------|-----|
| **Base URL** | `http://18.180.162.113:9191` |
| **ç«¯é»** | `/inst/getInst` |
| **æ–¹æ³•** | GET |
| **è¶…æ™‚** | 30 ç§’ |
| **é‡è©¦** | 3 æ¬¡ |
| **ç·©å­˜** | 10 åˆ†é˜ |

### åƒæ•¸

| åƒæ•¸ | é¡å‹ | å¿…éœ€ | èªªæ˜ |
|------|------|------|------|
| `symbol` | string | æ˜¯ | HKEX è‚¡ç¥¨ä»£ç¢¼ (å°å¯«, å¦‚ "0700.hk") |
| `duration` | integer | æ˜¯ | æ™‚é–“è·¨åº¦ (å¤©æ•¸, å¦‚ 1825 = 5 å¹´) |

### æ”¯æŒçš„è‚¡ç¥¨

**ä¸»è¦è‚¡ç¥¨** (20+ æ”¯):
```
0700.hk  - é¨°è¨Š (Tencent)
0388.hk  - é¦™æ¸¯äº¤æ˜“æ‰€ (HKEx)
1398.hk  - å·¥å•†éŠ€è¡Œ (ICBC)
0939.hk  - å»ºè¨­éŠ€è¡Œ (CCB)
3988.hk  - ä¸­åœ‹éŠ€è¡Œ (BoC)
2318.hk  - ä¸­åœ‹å¹³å®‰ (Ping An)
0883.hk  - ä¸­åœ‹çŸ³æ²¹ (CNPC)
0386.hk  - ä¸­åœ‹çŸ³åŒ– (Sinopec)
0941.hk  - ä¸­åœ‹ç§»å‹• (China Mobile)
... ä»¥åŠå…¶ä»– HKEX ä¸Šå¸‚å…¬å¸
```

---

## ğŸ’» ä½¿ç”¨æ–¹å¼

### Curl å‘½ä»¤ç¤ºä¾‹

**1 å¹´æ•¸æ“š**:
```bash
curl -X 'GET' \
  'http://18.180.162.113:9191/inst/getInst?symbol=0700.hk&duration=365' \
  -H 'accept: application/json'
```

**5 å¹´æ•¸æ“š**:
```bash
curl -X 'GET' \
  'http://18.180.162.113:9191/inst/getInst?symbol=0700.hk&duration=1825' \
  -H 'accept: application/json'
```

**3 å€‹æœˆæ•¸æ“š**:
```bash
curl -X 'GET' \
  'http://18.180.162.113:9191/inst/getInst?symbol=0700.hk&duration=90' \
  -H 'accept: application/json'
```

### Python ä½¿ç”¨ç¤ºä¾‹

```python
from src.data_adapters.hkex_http_adapter import HKEXHttpAdapter
from datetime import date, timedelta
import asyncio

async def main():
    adapter = HKEXHttpAdapter()

    # é€£æ¥åˆ° API
    if not await adapter.connect():
        print("é€£æ¥å¤±æ•—")
        return

    # ç²å–æ•¸æ“š
    df = await adapter.get_hkex_stock_data(
        symbol="0700.hk",
        start_date=date.today() - timedelta(days=365),
        end_date=date.today()
    )

    print(f"ç²å– {len(df)} å€‹äº¤æ˜“æ—¥")
    print(df.head())

    await adapter.disconnect()

asyncio.run(main())
```

---

## ğŸ“Š API éŸ¿æ‡‰æ ¼å¼

**é æœŸçš„ JSON çµæ§‹**:
```json
{
  "data": [
    {
      "date": "2024-01-01",
      "open": 409.03,
      "high": 410.50,
      "low": 408.50,
      "close": 409.50,
      "volume": 25000000
    },
    {
      "date": "2024-01-02",
      "open": 409.50,
      "high": 411.20,
      "low": 409.00,
      "close": 410.00,
      "volume": 26000000
    }
    // ... æ›´å¤šæ•¸æ“šé»
  ]
}
```

**è½‰æ›ç‚º DataFrame**:
```
        date      open      high       low     close      volume
0 2024-01-01   409.03   410.50   408.50   409.50   25000000
1 2024-01-02   409.50   411.20   409.00   410.00   26000000
2 2024-01-03   410.00   412.00   409.50   411.50   27000000
...
```

---

## ğŸ”§ é›†æˆæ­¥é©Ÿ

### æ­¥é©Ÿ 1: è®€å–é…ç½®

æ‰“é–‹ `CLAUDE.md` çš„ç¬¬ 20-100 è¡Œäº†è§£ API é…ç½®ã€‚

### æ­¥é©Ÿ 2: å°å…¥é©é…å™¨

```python
from src.data_adapters.hkex_http_adapter import HKEXHttpAdapter
```

### æ­¥é©Ÿ 3: åˆå§‹åŒ–ä¸¦é€£æ¥

```python
adapter = HKEXHttpAdapter()
connected = await adapter.connect()
```

### æ­¥é©Ÿ 4: ç²å–æ•¸æ“š

```python
df = await adapter.get_hkex_stock_data("0700.hk", start_date, end_date)
```

### æ­¥é©Ÿ 5: è™•ç†æ•¸æ“š

```python
# ä½¿ç”¨ DataFrame é€²è¡Œå›æ¸¬ç­‰æ“ä½œ
print(f"è‚¡ç¥¨ä»£ç¢¼: 0700.hk")
print(f"æ•¸æ“šé»: {len(df)}")
print(f"é–‹ç›¤: {df['open'].iloc[0]:.2f}")
print(f"æ”¶ç›¤: {df['close'].iloc[-1]:.2f}")
```

---

## âœ… æ–‡ä»¶æ¸…å–®

| æ–‡ä»¶ | è®Šæ›´ | èªªæ˜ |
|------|------|------|
| `CLAUDE.md` | âœ… å·²æ›´æ–° | æ·»åŠ  API é…ç½®ç« ç¯€ (ç¬¬ 20-100 è¡Œ) |
| `src/data_adapters/hkex_http_adapter.py` | âœ… æ–°å»º | æ–°çš„ HTTP API é©é…å™¨ (22 KB) |
| `HTTP_API_MIGRATION_GUIDE.md` | âœ… æ–°å»º | å®Œæ•´é·ç§»æŒ‡å— (12 KB) |
| `CURL_API_UPDATE_SUMMARY.md` | âœ… æ–°å»º | æœ¬æ–‡æª” (æœ¬æ–‡ä»¶) |

---

## ğŸ¯ é‡è¦ç‰¹æ€§

### è‡ªå‹•é‡è©¦æ©Ÿåˆ¶
```python
# 3 æ¬¡é‡è©¦ï¼ŒæŒ‡æ•¸é€€é¿
# 1st attempt: å¤±æ•—
# ç­‰å¾… 1 ç§’
# 2nd attempt: å¤±æ•—
# ç­‰å¾… 2 ç§’
# 3rd attempt: å¤±æ•— â†’ æ‹‹å‡ºç•°å¸¸
```

### æ™ºèƒ½ç·©å­˜
```python
# 10 åˆ†é˜ TTL
# åŒä¸€è«‹æ±‚åœ¨ 10 åˆ†é˜å…§è¿”å›ç·©å­˜æ•¸æ“š
# é¿å…é‡è¤‡ API èª¿ç”¨
```

### æ•¸æ“šé©—è­‰
```python
# æª¢æŸ¥åƒ¹æ ¼é‚è¼¯
# - é«˜ >= é–‹/æ”¶
# - ä½ <= é–‹/æ”¶
# - æˆäº¤é‡ >= 0
# è³ªé‡è©•åˆ† 0-1
```

### ç•°å¸¸è™•ç†
```python
# é€£æ¥è¶…æ™‚
# API ä¸å¯ç”¨
# éŸ¿æ‡‰æ ¼å¼éŒ¯èª¤
# æ•¸æ“šé©—è­‰å¤±æ•—
# ... å…¨éƒ¨å¦¥å–„è™•ç†
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æœ€ç°¡å–®çš„æ–¹å¼

```python
import asyncio
from src.data_adapters.hkex_http_adapter import HKEXHttpAdapter
from datetime import date, timedelta

async def test():
    adapter = HKEXHttpAdapter()
    await adapter.connect()

    # ç²å–é¨°è¨Šæœ€è¿‘ 1 å¹´æ•¸æ“š
    df = await adapter.get_hkex_stock_data(
        "0700.hk",
        date.today() - timedelta(days=365),
        date.today()
    )

    print(f"æˆåŠŸç²å– {len(df)} è¡Œæ•¸æ“š")

    await adapter.disconnect()

asyncio.run(test())
```

### é‹è¡Œçµæœ

```
[OK] Connected to HKEX HTTP API
[OK] Fetching HKEX data for 0700.hk (365 days)
[OK] Successfully fetched 247 data points for 0700.hk
æˆåŠŸç²å– 247 è¡Œæ•¸æ“š
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

| æ–‡æª” | å…§å®¹ | ä½•æ™‚æŸ¥çœ‹ |
|------|------|---------|
| `CLAUDE.md` | API ç«¯é»é…ç½® | é…ç½®æ–°é …ç›® |
| `hkex_http_adapter.py` | å¯¦ç¾ä»£ç¢¼ | ç†è§£å¯¦ç¾ |
| `HTTP_API_MIGRATION_GUIDE.md` | å®Œæ•´é·ç§»æŒ‡å— | é›†æˆåˆ°ç¾æœ‰ä»£ç¢¼ |
| `CURL_API_UPDATE_SUMMARY.md` | æœ¬æ–‡ä»¶ | å¿«é€Ÿåƒè€ƒ |

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **å°å¯«ç¬¦è™Ÿ**: å§‹çµ‚ä½¿ç”¨å°å¯« `0700.hk` è€Œä¸æ˜¯ `0700.HK`
2. **è¶…æ™‚è™•ç†**: API å¯èƒ½å¶çˆ¾éŸ¿æ‡‰ç·©æ…¢ï¼Œè‡ªå‹•é‡è©¦æœƒè™•ç†
3. **ç·©å­˜åˆ©ç”¨**: ç›¸åŒè«‹æ±‚åœ¨ 10 åˆ†é˜å…§è¿”å›ç·©å­˜æ•¸æ“š
4. **éŒ¯èª¤æ¢å¾©**: å¯¦ç¾äº†å®Œæ•´çš„ç•°å¸¸è™•ç†ï¼Œä½†å»ºè­°æ·»åŠ æ‡‰ç”¨ç´šåˆ¥çš„é‡è©¦
5. **æ•¸æ“šè³ªé‡**: æ‰€æœ‰è¿”å›çš„æ•¸æ“šéƒ½ç¶“éé©—è­‰ï¼Œä½è³ªé‡æ•¸æ“šæœƒè­¦å‘Š

---

## ğŸ” æ•…éšœæ’é™¤

### é€£æ¥å¤±æ•—
```bash
# æ¸¬è©¦ API é€£æ¥
curl 'http://18.180.162.113:9191/inst/getInst?symbol=0700.hk&duration=365'

# æª¢æŸ¥ç¶²çµ¡
ping 18.180.162.113
```

### æ•¸æ“šç‚ºç©º
```python
# æª¢æŸ¥ç¬¦è™Ÿæ ¼å¼ (å¿…é ˆå°å¯«)
# æª¢æŸ¥æ™‚é–“è·¨åº¦ (duration åƒæ•¸)
# æª¢æŸ¥ç¬¦è™Ÿæ˜¯å¦æœ‰æ•ˆ

# ä½¿ç”¨æ—¥èªŒèª¿è©¦
import logging
logging.getLogger("hk_quant_system.hkex_http_adapter").setLevel(logging.DEBUG)
```

### API è¶…æ™‚
```python
# è‡ªå‹•é‡è©¦æœƒè™•ç†
# å¦‚æœä»ç„¶å¤±æ•—ï¼Œæª¢æŸ¥ç¶²çµ¡é€£æ¥
# è€ƒæ…®ä½¿ç”¨æœ¬åœ°ç·©å­˜ä½œç‚ºå‚™ä»½
```

---

## ğŸ“ˆ æ€§èƒ½æ•¸æ“š

| æ“ä½œ | æ™‚é–“ | å‚™è¨» |
|------|------|------|
| é€£æ¥ API | < 1 ç§’ | é¦–æ¬¡é€£æ¥ |
| ç²å– 1 å¹´æ•¸æ“š | 2-3 ç§’ | ~250 äº¤æ˜“æ—¥ |
| ç²å– 5 å¹´æ•¸æ“š | 2-3 ç§’ | ~1250 äº¤æ˜“æ—¥ |
| æ•¸æ“šé©—è­‰ | < 0.5 ç§’ | åŒ…å« OHLCV æª¢æŸ¥ |
| ç·©å­˜å‘½ä¸­ | < 10 ms | è¿”å›ç·©å­˜æ•¸æ“š |

---

## âœ¨ ä¸‹ä¸€æ­¥

### ç«‹å³åŸ·è¡Œ
- [ ] è®€å– CLAUDE.md é…ç½®éƒ¨åˆ†
- [ ] æ¸¬è©¦ Curl å‘½ä»¤
- [ ] æ¸¬è©¦ Python ä»£ç¢¼

### çŸ­æœŸ
- [ ] æ›´æ–°ç¾æœ‰å›æ¸¬ä»£ç¢¼ä½¿ç”¨æ–°é©é…å™¨
- [ ] é‹è¡Œé›†æˆæ¸¬è©¦
- [ ] é©—è­‰æ•¸æ“šè³ªé‡

### ä¸­æœŸ
- [ ] æ£„ç”¨èˆŠçš„ yfinance é©é…å™¨
- [ ] å„ªåŒ–ç·©å­˜ç­–ç•¥
- [ ] æ·»åŠ æ›´å¤šç›£æ§

---

## ğŸ‰ å®Œæˆï¼

æ‰€æœ‰å¿…è¦çš„æ›´æ–°å·²å®Œæˆã€‚é …ç›®ç¾åœ¨çµ±ä¸€ä½¿ç”¨é›†ä¸­å¼ HTTP API Curl ç«¯é»ã€‚

### å¿«é€Ÿåƒè€ƒ

**API ç«¯é»**: `http://18.180.162.113:9191/inst/getInst`
**Python é©é…å™¨**: `src/data_adapters/hkex_http_adapter.py`
**é…ç½®æ–‡æª”**: `CLAUDE.md` (ç¬¬ 20-100 è¡Œ)
**é·ç§»æŒ‡å—**: `HTTP_API_MIGRATION_GUIDE.md`

---

**ç‹€æ…‹**: âœ… å®Œå…¨æ›´æ–° - ç”Ÿç”¢å°±ç·’
**æœ€å¾Œæ›´æ–°**: 2025-10-18
**ä¸‹ä¸€æ¬¡å¯©æŸ¥**: 2025-11-01

